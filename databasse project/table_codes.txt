DROP TABLE SYS.CHANNELS CASCADE CONSTRAINTS;

CREATE TABLE SYS.CHANNELS
(
  CHANNEL_ID    INTEGER,
  CHANNEL_NAME  VARCHAR2(255 CHAR),
  DESCRIPTION   CLOB
)
LOB (DESCRIPTION) STORE AS BASICFILE (
  TABLESPACE  SYSTEM
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING
  STORAGE    (
              INITIAL          64K
              NEXT             1M
              MINEXTENTS       1
              MAXEXTENTS       UNLIMITED
              PCTINCREASE      0
              FREELISTS        1
              FREELIST GROUPS  1
              BUFFER_POOL      DEFAULT
             ))
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;


CREATE UNIQUE INDEX SYS.CHANNELS_PK ON SYS.CHANNELS
(CHANNEL_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.CHANNELS ADD (
  CONSTRAINT CHANNELS_PK
  PRIMARY KEY
  (CHANNEL_ID)
  USING INDEX SYS.CHANNELS_PK
  ENABLE VALIDATE);


DROP TABLE SYS.ENTRIES CASCADE CONSTRAINTS;

CREATE TABLE SYS.ENTRIES
(
  ENTRY_ID    INTEGER                           NOT NULL,
  TITLE       VARCHAR2(255 BYTE)                NOT NULL,
  CONTENT     CLOB                              NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  CHANNEL_ID  INTEGER,
  CREATED_AT  TIMESTAMP(0),
  UPDATED_AT  TIMESTAMP(0)
)
LOB (CONTENT) STORE AS BASICFILE (
  TABLESPACE  SYSTEM
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING
  STORAGE    (
              INITIAL          64K
              NEXT             1M
              MINEXTENTS       1
              MAXEXTENTS       UNLIMITED
              PCTINCREASE      0
              FREELISTS        1
              FREELIST GROUPS  1
              BUFFER_POOL      DEFAULT
             ))
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;


CREATE UNIQUE INDEX SYS.ENTRIES_PK ON SYS.ENTRIES
(ENTRY_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.ENTRIES ADD (
  CONSTRAINT ENTRIES_PK
  PRIMARY KEY
  (ENTRY_ID)
  USING INDEX SYS.ENTRIES_PK
  ENABLE VALIDATE);


DROP TABLE SYS.MESSAGES CASCADE CONSTRAINTS;

CREATE TABLE SYS.MESSAGES
(
  MESSAGE_ID   INTEGER                          NOT NULL,
  SENDER_ID    INTEGER                          NOT NULL,
  RECEIVER_ID  INTEGER                          NOT NULL,
  CONTENT      CLOB                             NOT NULL,
  SENT_AT      TIMESTAMP(0),
  IS_READ      NUMBER                           NOT NULL,
  IS_RECEIVED  NUMBER                           NOT NULL,
  RECEIVED_AT  TIMESTAMP(0),
  READED_AT    TIMESTAMP(0),
  IS_SENT      NUMBER                           NOT NULL
)
LOB (CONTENT) STORE AS BASICFILE (
  TABLESPACE  SYSTEM
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING
  STORAGE    (
              INITIAL          64K
              NEXT             1M
              MINEXTENTS       1
              MAXEXTENTS       UNLIMITED
              PCTINCREASE      0
              FREELISTS        1
              FREELIST GROUPS  1
              BUFFER_POOL      DEFAULT
             ))
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;


CREATE UNIQUE INDEX SYS.MESSAGES_PK ON SYS.MESSAGES
(MESSAGE_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.MESSAGES ADD (
  CONSTRAINT MESSAGES_PK
  PRIMARY KEY
  (MESSAGE_ID)
  USING INDEX SYS.MESSAGES_PK
  ENABLE VALIDATE);


DROP TABLE SYS.REPORTS CASCADE CONSTRAINTS;

CREATE TABLE SYS.REPORTS
(
  REPORT_ID   INTEGER                           NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  ENTRY_ID    INTEGER                           NOT NULL,
  COMMENT_ID  INTEGER                           NOT NULL,
  REASON      CLOB,
  CREATED_AT  TIMESTAMP(0),
  STATUS      VARCHAR2(255 CHAR)
)
LOB (REASON) STORE AS BASICFILE (
  TABLESPACE  SYSTEM
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING
  STORAGE    (
              INITIAL          64K
              NEXT             1M
              MINEXTENTS       1
              MAXEXTENTS       UNLIMITED
              PCTINCREASE      0
              FREELISTS        1
              FREELIST GROUPS  1
              BUFFER_POOL      DEFAULT
             ))
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;


CREATE UNIQUE INDEX SYS.REPORTS_PK ON SYS.REPORTS
(REPORT_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.REPORTS ADD (
  CONSTRAINT REPORTS_PK
  PRIMARY KEY
  (REPORT_ID)
  USING INDEX SYS.REPORTS_PK
  ENABLE VALIDATE);


DROP TABLE SYS.SAVED_ENTRIES CASCADE CONSTRAINTS;

CREATE TABLE SYS.SAVED_ENTRIES
(
  SAVED_ID  INTEGER                             NOT NULL,
  USER_ID   INTEGER                             NOT NULL,
  ENTRY_ID  INTEGER                             NOT NULL,
  SAVED_AT  TIMESTAMP(0)
)
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;


CREATE UNIQUE INDEX SYS.SAVED_ENTRIES_PK ON SYS.SAVED_ENTRIES
(SAVED_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.SAVED_ENTRIES ADD (
  CONSTRAINT SAVED_ENTRIES_PK
  PRIMARY KEY
  (SAVED_ID)
  USING INDEX SYS.SAVED_ENTRIES_PK
  ENABLE VALIDATE);


DROP TABLE SYS.USERS CASCADE CONSTRAINTS;

CREATE TABLE SYS.USERS
(
  USER_ID          INTEGER,
  USERNAME         VARCHAR2(30 CHAR)            NOT NULL,
  EMAIL            VARCHAR2(50 CHAR)            NOT NULL,
  PASSWORD_HASH    VARCHAR2(255 CHAR)           NOT NULL,
  PROFILE_PICTURE  VARCHAR2(255 CHAR),
  CREATED_AT       TIMESTAMP(0),
  IS_ADMIN         NUMBER                       NOT NULL
)
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;

COMMENT ON COLUMN SYS.USERS.IS_ADMIN IS '1 means admin 0 means nonadmin';


CREATE UNIQUE INDEX SYS.USERS_PK ON SYS.USERS
(USER_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.USERS ADD (
  CONSTRAINT USERS_PK
  PRIMARY KEY
  (USER_ID)
  USING INDEX SYS.USERS_PK
  ENABLE VALIDATE
,  UNIQUE (USERNAME, EMAIL)
  USING INDEX
    TABLESPACE SYSTEM
    PCTFREE    10
    INITRANS   2
    MAXTRANS   255
    STORAGE    (
                INITIAL          64K
                NEXT             1M
                MINEXTENTS       1
                MAXEXTENTS       UNLIMITED
                PCTINCREASE      0
                FREELISTS        1
                FREELIST GROUPS  1
                BUFFER_POOL      DEFAULT
               )
  ENABLE VALIDATE);


--  There is no statement for index SYS.SYS_C007506.
--  The object is created when the parent object is created.
DROP TABLE SYS.COMMENTS CASCADE CONSTRAINTS;

CREATE TABLE SYS.COMMENTS
(
  COMMENT_ID  INTEGER                           NOT NULL,
  ENTRY_ID    INTEGER                           NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  CONTENT     CLOB                              NOT NULL,
  CREATED_AT  TIMESTAMP(0)
)
LOB (CONTENT) STORE AS BASICFILE (
  TABLESPACE  SYSTEM
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  NOCACHE
  LOGGING
  STORAGE    (
              INITIAL          64K
              NEXT             1M
              MINEXTENTS       1
              MAXEXTENTS       UNLIMITED
              PCTINCREASE      0
              FREELISTS        1
              FREELIST GROUPS  1
              BUFFER_POOL      DEFAULT
             ))
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;


CREATE UNIQUE INDEX SYS.COMMENTS_PK ON SYS.COMMENTS
(COMMENT_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.COMMENTS ADD (
  CONSTRAINT COMMENTS_PK
  PRIMARY KEY
  (COMMENT_ID)
  USING INDEX SYS.COMMENTS_PK
  ENABLE VALIDATE);


DROP TABLE SYS.LIKES CASCADE CONSTRAINTS;

CREATE TABLE SYS.LIKES
(
  LIKE_ID     INTEGER                           NOT NULL,
  ENTRY_ID    INTEGER                           NOT NULL,
  COMMENT_ID  INTEGER                           NOT NULL,
  USER_ID     INTEGER                           NOT NULL,
  CREATED_AT  TIMESTAMP(0)
)
TABLESPACE SYSTEM
PCTUSED    40
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;


CREATE UNIQUE INDEX SYS.LIKES_PK ON SYS.LIKES
(LIKE_ID)
LOGGING
TABLESPACE SYSTEM
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            FREELISTS        1
            FREELIST GROUPS  1
            BUFFER_POOL      DEFAULT
           );

ALTER TABLE SYS.LIKES ADD (
  CONSTRAINT LIKES_PK
  PRIMARY KEY
  (LIKE_ID)
  USING INDEX SYS.LIKES_PK
  ENABLE VALIDATE);


ALTER TABLE SYS.ENTRIES ADD (
  FOREIGN KEY (CHANNEL_ID) 
  REFERENCES SYS.CHANNELS (CHANNEL_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID) 
  REFERENCES SYS.USERS (USER_ID)
  ENABLE VALIDATE);

ALTER TABLE SYS.MESSAGES ADD (
  FOREIGN KEY (SENDER_ID) 
  REFERENCES SYS.USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (RECEIVER_ID) 
  REFERENCES SYS.USERS (USER_ID)
  ENABLE VALIDATE);

ALTER TABLE SYS.REPORTS ADD (
  FOREIGN KEY (USER_ID) 
  REFERENCES SYS.USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (ENTRY_ID) 
  REFERENCES SYS.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (COMMENT_ID) 
  REFERENCES SYS.COMMENTS (COMMENT_ID)
  ENABLE VALIDATE);

ALTER TABLE SYS.SAVED_ENTRIES ADD (
  FOREIGN KEY (USER_ID) 
  REFERENCES SYS.USERS (USER_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (ENTRY_ID) 
  REFERENCES SYS.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE);

ALTER TABLE SYS.COMMENTS ADD (
  FOREIGN KEY (ENTRY_ID) 
  REFERENCES SYS.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID) 
  REFERENCES SYS.USERS (USER_ID)
  ENABLE VALIDATE);

ALTER TABLE SYS.LIKES ADD (
  FOREIGN KEY (ENTRY_ID) 
  REFERENCES SYS.ENTRIES (ENTRY_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (COMMENT_ID) 
  REFERENCES SYS.COMMENTS (COMMENT_ID)
  ENABLE VALIDATE
,  FOREIGN KEY (USER_ID) 
  REFERENCES SYS.USERS (USER_ID)
  ENABLE VALIDATE);
